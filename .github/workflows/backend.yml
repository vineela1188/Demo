name: Build & Push Backend
on:
 push:
   branches:
     - main
   paths:
     - "backend/**"
 workflow_dispatch:  # allow manual run
jobs:
 build-backend-windows:
   runs-on: windows-latest
   steps:
     - name: Checkout repository
       uses: actions/checkout@v4
     - name: Set up JDK 21
       uses: actions/setup-java@v4
       with:
         distribution: 'temurin'
         java-version: '21'
     - name: Build backend with Maven
       working-directory: backend
       run: mvn clean package -DskipTests
     - name: Log in to Docker Hub
       uses: docker/login-action@v2
       with:
         username: ${{ secrets.DOCKERHUB_USERNAME }}
         password: ${{ secrets.DOCKERHUB_TOKEN }}
     - name: Build Docker image
       # On windows runners PowerShell is default; docker commands are the same.
       working-directory: backend
       run: |
         # define image name + tag
         IMAGE_NAME=${{ secrets.DOCKERHUB_USERNAME }}/my-backend-app
         IMAGE_TAG=latest
         docker build -t $IMAGE_NAME:$IMAGE_TAG .
     - name: Push Docker image
       run: |
         IMAGE_NAME=${{ secrets.DOCKERHUB_USERNAME }}/my-backend-app
         IMAGE_TAG=latest
         docker push $IMAGE_NAME:$IMAGE_TAG
